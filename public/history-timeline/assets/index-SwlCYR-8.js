(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const Tt="/history-timeline/sac-tag-icon-2023.svg",Ot="http://www.w3.org/2000/svg",g=(t,n)=>Object.entries(n).forEach(([s,o])=>t.setAttribute(s,o)),z=(t,n,...s)=>{const o=document.createElementNS(Ot,t);return n&&g(o,n),s&&s.forEach(r=>o.classList.add(r)),o},W=(t,n,s,o=1)=>{t*=360;const r=n*Math.min(s,1-s),i=d=>{const e=(d+t/30)%12,a=s-r*Math.max(Math.min(e-3,9-e,1),-1);return Math.round(255*a).toString(16).padStart(2,"0")};return o=Math.round(o*255).toString(16).padStart(2,"0"),`#${i(0)}${i(8)}${i(4)}${o}`},tt=new Date,qt=tt.getTime(),it=new Map;let N=null;const x={data:{},meta:{}},Ht=()=>{const r={selected:!1,cb:null,opt:{},hilite:()=>{const i=[...r.baseColor];if(r.selected){const d=(1-i[2])/2;i[2]+=d}g(r.svg,{fill:W(...i)})},do_select:i=>{N&&N!==r&&N.do_select(),r.selected=!r.selected,r.hilite(),r.cb(i,r),r.selected&&(N=r),!r.selected&&(N=null)},set_svg:(i,d,e)=>{r.baseColor=e,r.svg=i,r.svg.addEventListener("click",r.do_select,!1)},init:i=>(Object.assign(r,i),r)};return r},At=t=>{const n=r=>{const i=r.split("-").map(d=>Number(d));return Date.UTC(i[2],i[0]-1,i[1])},s=t.split(`

`),o=s[0].split(`
`);for(let r=1;r<s.length;r++){const i={},d=s[r].split(`
`);o.forEach((a,l)=>{i[a]=null,d[l]&&d[l]!=="Null"&&(i[a]=d[l])}),["From","To"].forEach(a=>{i[a]==="Now"?i[a]=tt:i[a]&&(i[a]=new Date(n(i[a])))});const e=Ht().init(i);e.From&&e.To?e.opt._delta=i.To.getTime()-i.From.getTime():e.opt._delta=0,delete e.Key,it.set(i.Key,e)}return it},jt=t=>JSON.stringify(t,null,1),Lt=(t,n,s)=>{const r=Array.from(Object.keys(n).map((m,p)=>({cat:m,o:n[m].order})));r.sort((m,p)=>Number(m.o)>=Number(p.o)?1:-1),r.forEach((m,p)=>{const f=Array(12);for(let w=0;w<f.length;w++)f[w]=[];x.data[m.cat]={index:p,order:m.o,depths:f,width:0,options:{color:n[m.cat].color}},Object.hasOwn(n[m.cat],"width")&&(x.data[m.cat].options.evt_width=n[m.cat].width)}),x.meta.ordered=r.map(m=>m.cat);const i=[...t.keys()],d=i.map(m=>t.get(m).From.getTime()),e=qt,a=Math.min(...d);console.log(new Date(a),"TO",tt);const l=e-a,u=m=>(e-m)/l,_=(m,p)=>{if(!Object.hasOwn(x.data,m.Cat))return null;const f=x.data[m.Cat].depths[p].length,w=m.opt.box.bottom,M=m.opt.box.top;for(let O=0;O<f;O++){const st=x.data[m.Cat].depths[p][O],A=t.get(st);if(A.opt._index===m.opt._index)continue;const q=A.opt.box.bottom,E=A.opt.box.top;if(M>E&&M<q||w>E&&w<q||w===q&&M===E)return _(m,p+1)}return p};return i.sort((m,p)=>t.get(m).opt._delta<=t.get(p).opt._delta?1:-1),i.forEach((m,p)=>{const f=t.get(m);f.cb=s,f.opt._index=p;const w=[u(f.From.getTime()),f.To?u(f.To.getTime()):null];f.opt.box={bottom:w[0],top:w[1]!==null?w[1]:w[0],span:w[1]!==null?w[0]-w[1]:1},f.opt.box.span===1&&(f.opt._single=!0);const M=_(f,0);f.opt._depth=M,M+1>x.data[f.Cat].width&&(x.data[f.Cat].width=M+1),x.data[f.Cat].depths[M].push(m)}),Object.keys(n).forEach((m,p)=>{x.data[m].depths=x.data[m].depths.filter((f,w)=>f.length>0)}),x.meta.time_end=e,x.meta.time_start=a,x.meta.evt_map=t,x},Ct=(t,n)=>Promise.all([fetch("/history-timeline/history-raw-parsed.txt").then(s=>s.text()),fetch("/history-timeline/history-groups.json").then(s=>s.json())]).then(([s,o])=>{const r=At(s);console.log(r);const i=Lt(r,o,n);t(jt(r),i)});let v=null,Q=null,B=null,T=null,R=null,X=null,P=null,rt=null,lt=null;const Dt=t=>{const n=Object.keys(v),s=t.orientation.value?"H":"V";s==="H"&&n.reverse();const o=(n.length-1)*t.label_gap;R=0,n.forEach((l,u)=>{const _=Object.hasOwn(v[l].options,"evt_width")?v[l].options.evt_width:1,m=v[l].width*_;v[l]._unit_width=m,R+=m});const r=t.raw_col_width,i=l=>l/R*(r-o),d=l=>l*t.span,e=t.center_pos;s==="H"?(g(X,{transform:`translate(0,${r}) rotate(-90.0)`}),g(P,{transform:`translate(0,${r}) rotate(-90.0)`})):(g(X,{transform:"translate(0,0)"}),g(P,{transform:"translate(0,0)"}));let a=0;n.forEach((l,u)=>{const _=i(v[l]._unit_width);g(T.labels[l],{transform:`translate(${a},0)`}),g(T.labels[l].querySelector("g.cat-marker-label"),{transform:`translate(${_},0) rotate(90.0)`}),g(T.labels[l].querySelector("g.cat-marker rect"),{width:_}),g(T.labels[l].querySelector("g.cat-marker-label rect"),{x:0,y:0,height:_,width:t.label_max_width+t.label_font_size*2}),g(T.labels[l].querySelector("g.cat-marker-label text"),{x:t.label_font_size,y:_/2}),g(T.environ[l],{transform:`translate(${a},${e})`});for(let m=0;m<v[l].depths.length;m++){const p=v[l].depths[m],f=v[l].options.evt_width,w=t.label_gap*(f||1),M=(v[l].width-1)*w,A=(i(v[l]._unit_width/v[l].width)*v[l].width-M)/v[l].width;for(let q=0;q<p.length;q++){const E=Q.get(p[q]),at=t.direction.value?1-E.opt.box.bottom:E.opt.box.top;E.opt._pos=d(at)-(E.opt._single?t.evt_span/2:0),E.opt._height=E.opt._single?t.evt_span:d(E.opt.box.span);let U=E.opt._height-w;U-w<2&&(U=t.evt_span),g(E.svg,{x:m*(A+w),y:E.opt._pos,width:A,height:U})}}a+=_+t.label_gap})},Nt=(t,n)=>{B=n,v=t.data,Q=t.meta.evt_map,t.meta.time_start,t.meta.time_end,rt=document.querySelector("#environment"),X=rt.querySelector("g.content"),lt=document.querySelector("#labels"),P=lt.querySelector("g.content"),T={labels:{},environ:{}},Object.keys(v).forEach((o,r)=>{const i=z("g",{},["cat-marker"]),d=z("rect",{height:B.span,width:50,fill:`${W(...v[o].options.color)}`,"fill-opacity":.3}),e=z("g",{},["cat-marker-label"]),a=z("rect",{x:0,y:0,fill:`${W(...v[o].options.color)}`}),l=z("text",{});l.innerHTML=`${o.toUpperCase()}`,g(l,{y:0,x:0,fill:"black","dominant-baseline":"middle","text-anchor":"start","font-size":B.label_font_size,"font-weight":"bold"}),e.appendChild(a),e.appendChild(l),i.appendChild(d),i.appendChild(e),T.labels[o]=i,P.appendChild(i);const u=z("g",{},["cat-group"]);for(let _=0;_<v[o].depths.length;_++){const m=v[o].depths[_];for(let p=0;p<m.length;p++){const f=Q.get(m[p]),w=z("rect",{id:m[p],fill:`${W(...v[o].options.color)}`,x:_,y:f.opt.box.top,width:10,height:f.opt.box.span});f.set_svg(w,t,v[o].options.color),u.appendChild(w)}}T.environ[o]=u,X.appendChild(u)});const s=[];return[...P.children].map((o,r)=>{const d=o.querySelector(".cat-marker-label").getBoundingClientRect();s.push(d.width)}),B.label_max_width=Math.max(...s),!0},It=()=>{function t(o){const r=o.getBoundingClientRect(),i=window.visualViewport?window.visualViewport.height:window.innerHeight;console.log(r,i),s.env_width=r.width,s.env_height=r.height,s.env_orientation?(s.row_span=s.span,s.col_span=s.env_height):(s.row_span=s.span,s.col_span=s.env_width)}function n(){return s.label_pad=(s.label_width-s.label_font_size)/2,s.timeline_level_width=Math.floor(s.bar_size/3),s}const s={scroll_offset:2,span_initial:5e3,span_base:5e3,span:5e3,footer_size:32,menu_size:32,bar_size:100,evt_span:8,label_gap:4,label_font_size:12,time_years:24,time_months:24,time_days:93,timeline_level_width:null,set_env_bounds:t,init:n};return s},ct=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let yt=new ArrayBuffer(4),dt=new Float32Array(yt),mt=new Uint32Array(yt),pt,j;function Yt(t){return pt=.5*(dt[0]=t),mt[0]=1597463007-(mt[0]>>1),j=dt[0],j=j*(1.5-pt*j*j),j}const H=t=>{let n,s;const o=e=>{d.raw=[...e],d.isdef?(n=[...d.b],d.a.forEach((a,l)=>{s=e[l]-a,d.b[l]=s,d.delta[l]=n[l]-s})):(d.a=[...e],d.isdef=!0)},r=()=>{d.isdef=void 0,d.b.fill(0),d.raw.fill(0),d.delta.fill(0)},i=()=>({initial:[...d.a],raw:[...d.raw],change:[...d.b],delta:[...d.delta]}),d={a:null,b:new Array(t).fill(0),raw:new Array(t).fill(0),delta:new Array(t).fill(0),isdef:void 0,unset:r,set:o,obj:i};return d},et=()=>{let t,n=["pan","rotate"];const s={pre:a=>{e.opt.interval&&setTimeout(s.start,Number(e.opt.interval)*e.opt.interval_delay)},start:()=>{e.attr.is==="down"&&(e.attr.interval=0,e.opt.interval_id=setInterval(a=>{s.next_t(a)},Number(e.opt.interval)))},clear:()=>{e.opt.interval_id&&clearInterval(Number(e.opt.interval_id)),e.opt.interval_id=void 0,e.attr.interval=void 0},next_t:a=>{e.attr.interval++,e.cb(a,e)}},o={_angle_prop:2,meters:{pan:H(2),zoom:H(2),rotate:H(2)},_map:new Map,_mct:0,end:a=>{for(let l of a)o._map.delete(l.identifier),o._mct--},start:a=>{for(let l of a)o._map.set(l.identifier,{x:l.clientX,y:l.clientY,index:o._mct}),o._mct++},read:a=>{for(let l of a){const u=o._map.get(l.identifier);u.x=l.clientX,u.y=l.clientY}},scan:()=>{if(o._mct===0&&o.meters.pan.unset(),o._mct===1){const a=o._map.get([...o._map.keys()][0]);a.index=0,o.meters.zoom.unset(),o.meters.rotate.unset(),o.meters.pan.set([a.x,a.y])}if(o._mct===2){const a=o.distance_and_angle();for(let l in o.meters)l!=="pan"&&o.meters[l].set(a[l])}},distance_and_angle:()=>{const a=[...o._map.keys()],l=[o._map.get(a[0]),o._map.get(a[1])];l[1].x>l[0].x&&l.reverse();let[u,_]=[l[0].x-l[1].x,l[0].y-l[1].y];const m=u**2+_**2,p=[];return o._angle_prop===1?p[0]=[Math.atan2(_,u)]:(p[0]=l[0].x+(l[0].x-l[1].x)/2,p[1]=l[0].y+(l[0].y-l[1].y)/2),{zoom:[Yt(m)*m],rotate:p}}},r=a=>{if(e.attr.type=a.type,e.opt.blocks&&a.preventDefault(),e.opt.blocks&&a.stopImmediatePropagation(),e.opt.eventlet_type==="keyboard"){const l=u=>{e.attr.KEYS.forEach(_=>{e.attr[_]!==void 0&&(e.attr[_]=!e.attr[_],e.attr.KEYS.includes(_)&&e.attr.KEYS.splice(e.attr.KEYS.indexOf(_),1))}),e.attr.KEYS.length===0?(clearInterval(e.opt.interval_timer),e.opt.interval_timer=void 0):e.cb(u,e)};a.type==="keydown"&&(e.attr.KEYS.includes(a.code)||e.attr.KEYS.push(a.code),e.opt.interval_timer||(l(a),e.opt.interval_timer=setInterval(u=>{l(a)},e.opt.interval))),a.type==="keyup"&&(e.attr.KEYS.includes(a.code)&&e.attr.KEYS.splice(e.attr.KEYS.indexOf(a.code),1),e.attr.KEYS.length===0&&(clearInterval(e.opt.interval_timer),e.opt.interval_timer=void 0,e.cb(a,e)))}if(e.opt.eventlet_type==="pointer"){if(e.mobile&&(t=a.changedTouches),a.buttons&&(e.attr.button=a.buttons),(a.type==="mousedown"||a.type==="touchstart")&&(e.opt.interval&&s.clear(),e.opt.interval&&s.pre(),e.attr.is="down",e.mobile&&o.start(t),e.desktop&&e.meters[n[e.attr.button-1]].set([a.clientX,a.clientY])),(a.type==="mouseup"||a.type==="mouseleave"||a.type==="touchend"||a.type==="touchcancel")&&(e.mobile&&o.end(t),e.desktop&&e.attr.drag&&e.meters[n[e.attr.button-1]].unset(),o._mct===0&&(e.attr.is="up"),e.opt.interval&&s.clear(),e.attr.drag=!1),a.type==="mousemove"||a.type==="touchmove"){e.attr.drag=e.attr.is==="down";const u=e.meters[n[e.attr.button-1]];e.mobile&&o.read(t),e.desktop&&(e.attr.drag&&u.set([a.clientX,a.clientY]),!e.attr.drag&&u&&u.unset())}a.type==="wheel"&&(e.meters.wheel.set([a.deltaX,a.deltaY]),clearTimeout(e.opt.wheel_timer),e.opt.wheel_timer=setTimeout(()=>{e.meters.wheel.unset(),e.attr.wheel=void 0,e.cb(a,e)},e.opt.wheel_timeout)),e.mobile&&o.scan();const l=e.mobile?o:e;Object.keys(l.meters).forEach(u=>{l.meters[u].isdef?e.attr[u]=l.meters[u].obj():e.attr[u]=void 0}),e.cb(a,e)}},i={pointer:{blocks:!0,wheel_timer:null,wheel_timeout:50,interval_delay:2,interval:!1,context_disable:!1},keyboard:{blocks:!0,interval_timer:null,interval:200,toggle:["Space","Tab"]}},d=(a,l,u)=>{const _=u.eventlet_type,m={...i[_]};Object.assign(m,u),e.target=a,e.cb=l,e.opt=m,e.mobile=ct(),e.desktop=!e.mobile,e.attr.id=a.self===a?"window":a.id,e.opt.eventlet_type==="pointer"?(a.addEventListener("mousedown",e.act,{passive:!1}),a.addEventListener("mouseup",e.act,{passive:!1}),a.addEventListener("mousemove",e.act,{passive:!1}),a.addEventListener("mouseleave",e.act,{passive:!1}),a.addEventListener("mouseenter",e.act,{passive:!1}),a.addEventListener("wheel",e.act,{passive:!1}),a.addEventListener("touchstart",e.act,{passive:!1}),a.addEventListener("touchcancel",e.act,{passive:!1}),a.addEventListener("touchmove",e.act,{passive:!1}),a.addEventListener("touchend",e.act,{passive:!1}),e.opt.context_disable===!0&&a.addEventListener("contextmenu",p=>{p.preventDefault()}),e.meters={wheel:H(2),zoom:H(2),pan:H(2),rotate:H(2)}):(e.attr.KEYS=[],e.opt.toggle.forEach(p=>e.attr[p]=!1),a.addEventListener("keydown",e.act,{passive:!1}),a.addEventListener("keyup",e.act,{passive:!1}))},e={opt:{},attr:{},context:ct()?"mobile":"desktop",target:null,cb:null,init:d,act:r};return e},c=It().init(),Ft=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);document.documentElement.style.setProperty("--bar-s",c.bar_size+"px");let k=null,ut=null,V=null,Pt=et(),Kt=et(),y={suspend:!1,zoom:[1,1],zoom_previous:[1,1],scroll:[0,0]},b=null,gt,vt,xt=[],G=null,h={},St={};const Z=8;!Ft()&&(V=et());[gt,vt]=[window.visualViewport?window.visualViewport.width:window.innerWidth,window.visualViewport?window.visualViewport.height:window.innerHeight];const _t=()=>{const t={canon:0,cb:null,isDown:!1,start:null,pos:null,ex:null,e_target:null,vel:0,o_delta:0,momentumID:null,m_start:n=>{t.o_delta=0,t.isDown=!0,t.start=n,t.pos=t.canon,t.cancelMomentumTracking()},m_end:()=>{t.isDown=!1,t.beginMomentumTracking()},m_move:n=>{if(!t.isDown)return;const s=(n-t.start)*1;let o=t.canon;t.canon=t.pos-s,t.vel=t.canon-o,t.cb(),t.o_delta=t.canon-o},beginMomentumTracking:()=>{t.cancelMomentumTracking(),t.momentumID=requestAnimationFrame(t.momentumLoop)},cancelMomentumTracking:()=>{cancelAnimationFrame(t.momentumID)},momentumLoop:()=>{t.canon+=t.vel,t.vel*=.95,t.cb(),Math.abs(t.vel)>.5&&(t.momentumID=requestAnimationFrame(t.momentumLoop))}};return t},S=[_t(),_t()],kt=(t=!1)=>{const n=$.orientation.value;b=["V","H"][+n],console.error("pilot orientation.value",b),t&&b==="H"&&S.reverse(),t||S.reverse(),t||y.scroll.reverse()},$={orientation:{type:"bool",value:!1,text:["horizontal","vertical"]},direction:{type:"bool",value:!1,text:["reverse","forward"]},scale:{type:"multi",value:0,index_value:2,text:["larger","smaller","auto"]},density:{type:"any",value:1},scroll:{type:"any",value:"0,0"},test:{type:"bool",value:!1,text:["reset","reset"]}},Vt=()=>{Object.keys($).map((t,n)=>{const s=$[t],o=localStorage.getItem(t),r=d=>{switch(d.type){case"bool":return+d.value;default:return d.value}},i=(d,e)=>{switch(d.type){case"bool":return[!1,!0][Number(e)];case"int":return Number(e);default:return e}};o!==null?s.value=i(s,o):localStorage.setItem(t,r(s)),console.log(t,o,s.value)}),Object.assign(c,$)},Bt=t=>{t.preventDefault();const n=t.target,s=n.id,o=$[s];if(s&&o.type==="bool"&&(o.value=!o.value,c[`env_${n.id}`]=o.value,localStorage.setItem(s,+o.value),n.innerHTML=o.text[+o.value]),s&&o.type==="multi"){const r=o.text.length;let i=Number(o.value);i=i<r-1?i+1:0,o.value=i,c[`env_${n.id}`]=o.value,localStorage.setItem(s,+o.value),n.innerHTML=o.text[o.value]}s&&s==="orientation"&&kt(),s&&s==="test"&&Wt(),Object.assign(c,$),Xt()};Vt();const Wt=()=>{y.zoom=[1,1],y.scroll=[0,0]},Xt=()=>{nt(),k&&k.update(),J(),D()},K=(t,n,s)=>t>s?s:t<n?n:t;S[0].cb=()=>{const t=b==="V"?0:1,n=b==="V"?1:0,s=S[t].vel;y.scroll[n]=K(y.scroll[n]+s,0,c.span),D()};S[1].cb=()=>{const n=S[b==="V"?1:0].vel;y.zoom[0]*=1-n/200,J(),D()};kt("initial");let L=0,C=0,ht=b,I=0;const Jt=(t,n)=>{h.footer.innerHTML=n.Name},ft=(t,n)=>{if(n.hasOwnProperty("watch")&&n.watch(),n.attr.id==="environment"&&n.desktop&&n.attr.wheel){let s=b==="H"?0:1,o=b==="H"?1:0;const r=n.attr.wheel?n.attr.wheel.raw[s]:0,i=n.attr.wheel?n.attr.wheel.raw[o]:0;y.scroll[s]=K(y.scroll[s]+r,0,c.span),y.scroll[o]=K(y.scroll[o]+i,0,c.span),D();return}if(n.attr.id==="timeline-svg"&&n.desktop&&n.attr.wheel){let s=b==="H"?0:1,o=b==="H"?1:0;const r=n.attr.wheel?n.attr.wheel.raw[s]:0,i=n.attr.wheel?n.attr.wheel.raw[o]:0;y.zoom[0]*=1-i/200,J(),y.scroll[s]=K(y.scroll[s]+r,0,c.span),D();return}if((n.attr.id==="timeline-svg"||n.attr.id==="environment")&&n.mobile&&n.attr.zoom){t.preventDefault();let s=b==="V"?1:0;L=n.attr.zoom.initial[0],C=n.attr.zoom.initial[0]+n.attr.zoom.change[0],(n.attr.type==="touchmove"||n.attr.type==="mousemove")&&S[s].m_move(C),(n.attr.type==="touchstart"||n.attr.type==="mousedown")&&S[s].m_start(L),(n.attr.type==="touchend"||n.attr.type==="mouseup")&&S[s].m_end();return}if(n.attr.id==="environment"&&n.mobile){let s=b==="H"?1:0,o=b==="H"?0:1;n.attr.pan&&(L=n.attr.pan.initial[o],C=n.attr.pan.initial[o]+n.attr.pan.change[o]),(n.attr.type==="touchmove"||n.attr.type==="mousemove")&&S[s].m_move(C),(n.attr.type==="touchstart"||n.attr.type==="mousedown")&&S[s].m_start(L),(n.attr.type==="touchend"||n.attr.type==="mouseup")&&S[s].m_end();return}n.attr.id==="timeline-svg"&&[1,0].forEach((s,o)=>{if(n.attr.pan){if(!I){let i=Math.abs(n.attr.pan.change[0])>Math.abs(n.attr.pan.change[1]);b==="H"&&(i=!i),ht=+i,I=!0}L=n.attr.pan.initial[o],C=n.attr.pan.initial[o]+n.attr.pan.change[o]}let r=I&&s===ht;b==="H"&&(r=!r),r&&(n.attr.type==="touchmove"||n.attr.type==="mousemove")&&S[s].m_move(C),(n.attr.type==="touchstart"||n.attr.type==="mousedown")&&(I=!1,S[s].m_start(L)),(n.attr.type==="touchend"||n.attr.type==="mouseup")&&(I=!1,S[s].m_end())})},Ut=(t,n)=>{n.hasOwnProperty("watch")&&n.watch(),n.desktop&&n.attr.hasOwnProperty("Tab")};V&&V.init(window,Ut,{eventlet_type:"keyboard"});V&&ut&&ut.attach(V);const Rt=(t,n)=>{console.log(n),G=n,c.TS=G.meta.time_start,c.TE=G.meta.time_end;const s=Object.keys($).map((o,r)=>{const i=$[o];if(c[`env_${o}`]=i.value,i.type==="bool")return`<button class="boolean_value btn" href="#" id="${o}">${i.text[+i.value]}</button>`;if(i.type==="multi")return`<button class="boolean_value btn" href="#" id="${o}">${i.text[+i.value]}</button>`}).join("");document.querySelector("#app").innerHTML=`

  <div id="control">
    <button id="dims" class="btn"></button>
    <div id="abs">ยบ</div>
    ${s}
    <a href="/" target="_self">
      <img src="${Tt}" class="logo" alt="SAC logo" />
    </a>
  </div>

  <div id="main">
    <div id="timeline" class="contain">
      <svg id="timeline-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <g class="content">
          <g class="year single-column"></g>
          <g class="month single-column"></g>
          <g class="day single-column"></g>
        </g>
      </svg>
    </div>

    <div id="content" class="contain">
      <div id="content-environment">
        <svg id="environment" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g class="content"></g>
        </svg>
      </div>
      <div id="content-labels">
        <svg id="labels" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g class="content"></g>
        </svg>
      </div>
    </div>

    <div id="timeline-overlay">
      <div class="graphic">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g class="content">
            <path d="M 0 0 L 0 -${Z} L ${Z*2} 0 L 0 ${Z} Z" fill="white" />
          </g>
          <line x1="0" y1="0" x2="200" y2="0" stroke-dasharray="2" stroke="white"/>
        </svg>
      </div>
      <div class="content">
        <button id="selected-date" class="date-selection btn" href="#" data-value="1">??</button>
      </div>
    </div>

  </div>

  <div id="footer">
    <a href="/" target="_self">link</a>
  </div>


  `,Nt(n,c),Gt(),nt(),Pt.init(h.timeline_svg,ft,{eventlet_type:"pointer",blocks:!1}),Kt.init(h.content_svg,ft,{eventlet_type:"pointer",blocks:!1}),k=de().init(),k.build_dom(),k.update(),J(),D()},Gt=()=>{h.ABS=document.querySelector("#abs"),h.selected_date=document.querySelector("#selected-date"),h.footer=document.querySelector("#footer"),h.timeline=document.querySelector("#timeline"),h.timeline_svg=document.querySelector("#timeline-svg"),h.timeline_overlay=document.querySelector("#timeline-overlay"),h.timeline_overlay_svg=document.querySelector("#timeline-overlay svg"),h.timeline_overlay_carat=document.querySelector("#timeline-overlay g.content"),h.timeline_overlay_line=document.querySelector("#timeline-overlay line"),h.content=document.querySelector("#content"),h.content_labels=document.querySelector("#content-labels"),h.content_labels_svg=document.querySelector("#content-labels svg"),h.content_env=document.querySelector("#content-environment"),h.content_svg=document.querySelector("#environment"),h.main=document.querySelector("#main"),document.querySelectorAll(".boolean_value").forEach((t,n)=>{t.addEventListener("click",Bt,!1)})},$t=()=>{const t=[c.dims.w,c.dims.h-c.menu_size-c.footer_size];b==="H"&&t.reverse();const n=[0,c.center_pos],s=[t[0],c.span+t[1]],o=[c.raw_col_width,c.span+t[1]];b==="H"&&(n.reverse(),s.reverse(),o.reverse()),h.timeline_svg.style.width=`${s[0]}px`,h.timeline_svg.style.height=`${s[1]}px`;const r=h.timeline_svg.querySelector("g.content");g(r,{transform:`translate(${n[0]},${n[1]})`}),h.content_svg.style.width=`${o[0]}px`,h.content_svg.style.height=`${o[1]}px`,Dt(c),k&&Number(St[ot[c.columns-1]])},nt=()=>{console.warn("sent main",b,c.scale),c.dims={w:window.visualViewport?window.visualViewport.width:window.innerWidth,h:window.visualViewport?window.visualViewport.height:window.innerHeight};const t=[c.dims.w,c.dims.h-c.menu_size-c.footer_size];g(h.timeline_overlay_carat,{transform:b==="H"?`translate(${c.bar_size/2},0) rotate(90)`:`translate(0,${c.bar_size/2})`}),g(h.timeline_overlay_line,{transform:b==="H"?`translate(${c.bar_size/2},0) rotate(90)`:`translate(0,${c.bar_size/2})`,x2:t[0]}),h.main.style["flex-direction"]=b==="V"?"row":"column",h.main.style.width=`${t[0]}px`,h.main.style.height=`${t[1]}px`,b==="H"&&t.reverse();const n=[t[0],c.bar_size];b==="H"&&n.reverse(),g(h.timeline_overlay_svg,{width:n[0],height:n[1]}),c.center_pos=t[1]/2;const o=[t[0]-c.bar_size,2e3,400][Number(c.scale.value)];c.raw_col_width=o,console.log(c.bar_size,o);const r={timeline:{dims:[t[0],t[1]]},timeline_overlay:{pos:[0,t[1]/2-c.bar_size/2],dims:[t[0],c.bar_size]},content:{dims:[t[0]-c.bar_size,t[1]],pos:[c.bar_size,0]},content_labels:{dims:[o,t[1]]},content_labels_svg:{dims:[o,t[1]]},content_env:{dims:[o,t[1]]},content_svg:{dims:[o,c.span+t[1]]}};Object.entries(r).forEach(([e,a])=>{a.dims&&(b==="H"&&a.dims.reverse(),h[e].style.width=`${a.dims[0]}px`,h[e].style.height=`${a.dims[1]}px`),a.pos&&(b==="H"&&a.pos.reverse(),h[e].style.left=`${a.pos[0]}px`,h[e].style.top=`${a.pos[1]}px`)});const i=`${gt.toFixed(2)} x ${vt.toFixed(2)}`,d=document.querySelector("#dims");d.innerHTML=i,$t()},Et=t=>`${t}`.padStart(2,"0"),Mt=t=>t%4==0&&t%100!=0||t%400==0,bt=(t,n)=>[31,Mt(t)?29:28,31,30,31,30,31,31,30,31,30,31][n],Zt=t=>(c.TE-t)/(c.TE-c.TS),Qt=t=>t/(c.TE-c.TS),ot=["year","month","day"],te=[{t:"month",i:1},{t:"day",i:2},{t:"year",i:0}],zt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ee=t=>{const[n,s,o]=new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t).split("/");return{day:s,month:n,year:o}},ne=[[1,0,0],[1,1,0],[1,1,0]],oe=(t,n)=>{k.dom_groups[t].forEach((s,o)=>{if(s.showing(!1),n[o]!==void 0){const r=n[o],i=k.stash[t][r];Object.assign(s.opt,i),s.opt.label=t==="month"?zt[s.opt.i-1]:s.opt.value,s.set_pos(),s.showing(!0)}})},se=(t,n,s)=>{let o,r;return o=t-n<0?0:t-n,r=t+n>s?s:t+n,[r===s?s-n*2:o,r+(o===0?Math.abs(t-n):0)]},ae=()=>{const t=["year","month","day"],n=[6,8,15];let s,o,r;const i=k.bank.get(xt);if(i)for(let d=0;d<c.columns;d++)s=Array.from({length:k.groups[t[d]]},(e,a)=>a),[o,r]=se(i[d],n[d],k.groups[t[d]]),s=s.slice(o,r+1),oe(t[d],s)},ie=t=>{console.log("columns changed from",c.columns,"to",t),t<c.columns&&k.dom_groups[ot[c.columns-1]].forEach((s,o)=>{s.showing(!1)});const n=ne[t-1];c.columns=t,c.den=n,c.pitch=c.bar_size/c.columns,k&&k.update()};let re=null;const D=t=>{if(!k||!c.time_start_abs)return;const n=$.orientation.value,s=$.direction.value,o=c.TE-c.TS,r=(n?y.scroll[0]:y.scroll[1])/c.span,i=s?1-r:r,d=c.TE-o*i,e=ee(d),l=[e.year,e.month,e.day].join("-"),u=`${e.year}-${e.month}-${e.day}`;if(re!==u){const _=`${zt[Number(e.month)-1]} ${e.day} ${e.year}`;h.selected_date.innerHTML=_,xt=l,localStorage.setItem("scroll",y.scroll),ae()}h.timeline.scrollTo(...y.scroll),h.content_env.scrollTo(...y.scroll)};let wt=null,Y,F;const J=t=>{const n=b==="V"?1:0,s=y.scroll[n]/c.span;y.zoom[0]=K(y.zoom[0],.25,800),c.span=c.span_base*y.zoom[0],y.scroll[n]=s*c.span,Y=Math.round(c.span/c.span_initial),Y!==wt&&(F=1,Y>8&&(F=2),Y>75&&(F=3),F!==c.columns&&ie(F),wt=Y,localStorage.setItem("density",Math.round(y.zoom[0]))),$t()},le=(t,n)=>{const s=d=>{const e=z("g",{}),a=z("text",{});a.innerHTML=`${d}`,g(a,{y:0,x:0,"dominant-baseline":"middle","text-anchor":"middle","font-weight":"bold"});const l=z("rect",{});return e.appendChild(l),e.appendChild(a),e.classList.add("time-element"),e},o=d=>{i.svg.style.visibility=["hidden","visible"][+d]},r=()=>{const d=$.orientation.value,e=$.direction.value;i.opt.normal=Zt(i.opt.t),i.opt.span=Qt(i.opt.ms);const l=[0,(e?1-i.opt.normal:i.opt.normal)*c.span];d&&l.reverse(),g(i.svg,{transform:`translate(${l[0]}, ${l[1]})`});const u=i.svg.querySelector("rect"),_=[0,i.opt.span*c.span*+!e*-1],m=ot.indexOf(i.type)+1,p=[c.columns===m?c.raw_col_width+c.bar_size:c.pitch,i.opt.span*c.span];d&&_.reverse(),d&&p.reverse();const f=i.opt.i;g(u,{x:_[0],y:_[1],width:p[0],height:p[1],class:f%2===0?"svg-date-box-even":"svg-date-box-odd"});const w=i.opt.span*c.span*(e?0:-1),M=i.svg.querySelector("text"),O=[w+8,8];!d&&O.reverse(),M.innerHTML=i.opt.label,g(M,{x:O[0],y:O[1]}),St[i.type]=i.opt.span*c.span},i={type:t,opt:n,svg:s(n.label),showing:o,set_pos:r};return i},ce=(t,n)=>{const s=e=>e*864e5,o=[{t:"year",s:t.y_start,d:0,n:t.years_delta,f:"setFullYear",ttl:0},{t:"month",s:0,d:1,n:12,f:"setMonth",ttl:0},{t:"day",s:0,d:1,n:31,f:"setDate",ttl:0}];let r=0,i=n;const d=(e,a)=>{const l=o[a],u=l.t==="day"?bt(e[0],e[1]-1):l.n;for(let _=0;_<u;_++){e[a]=l.s+l.d+_;const m=e.slice(0,a+1).map(f=>Et(f)).join("-");!t.bank.get(m)&&t.bank.set(m,o.map(f=>f.ttl));const p={id:m,t:i,i:_+1,f:l.ttl,value:_+1};l.t==="day"&&(r++,p.day=r,p.ms=s(1),i+=864e5),l.t==="year"&&(p.value=t.y_start+_,p.days=Mt(e[0])?366:365,p.ms=s(p.days),r=0),l.t==="month"&&(p.days=bt(e[0],e[1]-1),p.ms=s(p.days)),t.stash[l.t].push(p),a+1<o.length&&d(e,a+1),l.ttl++}e[a]=l.s+l.d};d([t.y_start,0,1],0),console.log(t.stash)},de=()=>{const o={hash:{},bank:new Map,hash_map:{year:new Map,month:new Map,day:new Map},years_delta:null,times:{year:new Map,month:new Map,day:new Map},build_dom:()=>{Object.keys(o.dom_groups).forEach((r,i)=>{const d=h.timeline_svg.querySelector(`.${r}`),e=o.dom_groups[r];o.dom_groups[r]=[];for(let a=0;a<e;a++){const l={...o.stash[r][a]};l.label=Et(r==="year"?o.y_start+a:a),l.level=i;const u=le(r,l);d.appendChild(u.svg),o.dom_groups[r].push(u),u.showing(!1)}})},update:()=>{const r=$.orientation.value;$.direction.value,$.density.value,c.bar_size/2,te.filter(d=>d.i<c.columns).forEach((d,e)=>{const a=h.timeline_svg.querySelector(`g.${d.t}`),l=[e*c.pitch,0];r&&l.reverse(),g(a,{transform:`translate(${l[0]}, ${l[1]})`});for(let u=0;u<o.dom_groups[d.t].length;u++)o.dom_groups[d.t][u].set_pos()})},init:()=>(o.y_start=new Date(c.TS).getFullYear(),o.y_end=new Date(c.TE).getFullYear()+1,o.years_delta=o.y_end-o.y_start,[c.time_start_abs,c.time_end_abs]=[new Date(`01/01/${o.y_start}`).getTime(),new Date(`01/01/${o.y_end} 00:00:00`).getTime()],o.stash={day:[],month:[],year:[]},o.dom_groups={year:c.time_years,month:c.time_months,day:c.time_days},o.groups={day:(c.time_end_abs-c.time_start_abs)/864e5,month:o.years_delta*12,year:o.years_delta},ce(o,c.time_start_abs),o)};return o};window.addEventListener("resize",nt,{passive:!1});Ct(Rt,Jt);
